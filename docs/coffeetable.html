<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>coffeetable.coffee</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>coffeetable.coffee</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-0'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-0">#</a>
        </div>
        <h1>CoffeeTable v0.3.0</h1>
<p>A drop-in, CoffeeScript-fluent console for web pages.</p>
<ul>
<li><a href="http://code.alecperkins.net/coffeetable">Demo + Instructions</a></li>
<li><a href="https://github.com/alecperkins/coffeetable">GitHub repo</a></li>
</ul>
<h2>To use</h2>
<p>Load <code>coffeetable-min.js</code> into the page:
<code>&lt;script type="application/javascript" src="http://code.alecperkins.net/coffeetable/coffeetable-min.js"&gt;&lt;/script&gt;</code>
...and the widget will automatically initialize.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-1'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-1">#</a>
        </div>
        <h2>Settings and prep</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">VERSION = </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-2'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-2">#</a>
        </div>
        <p>Default widget settings.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">defaults =</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-3'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-3">#</a>
        </div>
        <p>Automatically load jQuery and CoffeeScript if not found in page</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">autoload_coffee_script   : </span><span class="kc">true</span>
    <span class="nv">autoload_jquery          : </span><span class="kc">true</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-4'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-4">#</a>
        </div>
        <p>URLs of CoffeeScript and jQuery files to load </p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">coffeescript_js : </span><span class="s1">&#39;http://cdnjs.cloudflare.com/ajax/libs/coffee-script/1.2.0/coffee-script.min.js&#39;</span>
    <span class="nv">jquery_js       : </span><span class="s1">&#39;http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.1/jquery.min.js&#39;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-5'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-5">#</a>
        </div>
        <p>Persist the history using localStorage</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">local_storage   : </span><span class="kc">true</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-6'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-6">#</a>
        </div>
        <p>Key to persist data with in localStorage</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">ls_key          : </span><span class="s1">&#39;coffee-table&#39;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-7'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-7">#</a>
        </div>
        <p>Clear the history on load</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">clear_on_load   : </span><span class="kc">false</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-8'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-8">#</a>
        </div>
        <p>Replay the history on load</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">replay_on_load  : </span><span class="kc">false</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-9'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-9">#</a>
        </div>
        <p>Default to multi-line mode</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">multi_line      : </span><span class="kc">false</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-10'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-10">#</a>
        </div>
        <p>Characters to use as indentation when TAB is pressed</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">indent          : </span><span class="s1">&#39;    &#39;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-11'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-11">#</a>
        </div>
        <p>Enable auto-suggest panel</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">auto_suggest    : </span><span class="kc">true</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-12'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-12">#</a>
        </div>
        <p>Widget positioning on the screen (CSS values)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">widget_position : </span><span class="s1">&#39;fixed&#39;</span>
    <span class="nv">widget_top      : </span><span class="s1">&#39;5px&#39;</span>
    <span class="nv">widget_right    : </span><span class="s1">&#39;5px&#39;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-13'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-13">#</a>
        </div>
        <p>ID attribute of widget div.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-14'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-14">#</a>
        </div>
        <p>Defaults to including a timestamp for extra (excessive?) uniqueness</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">widget_id       : </span><span class="s2">&quot;CoffeeTable-#{ (new Date()).getTime() }&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-15'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-15">#</a>
        </div>
        <p>Adopt console.log and console.dir if they are not available in the
browser. This is useful in browsers like IE.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">adopt_log       : </span><span class="kc">true</span>
    <span class="nv">adopt_dir       : </span><span class="kc">true</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-16'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-16">#</a>
        </div>
        <p>Keypress codes, for convenience.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">keycode =</span>
    <span class="nv">UP          : </span><span class="mi">38</span>
    <span class="nv">DOWN        : </span><span class="mi">40</span>
    <span class="nv">ENTER       : </span><span class="mi">13</span>
    <span class="nv">TAB         : </span><span class="mi">9</span>
    <span class="nv">BACKSPACE   : </span><span class="mi">8</span>
    <span class="nv">ESCAPE      : </span><span class="mi">27</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-17'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-17">#</a>
        </div>
        <p>Template for widget markup and style.
<code>__ID__</code> will be replaced by the setting for widget_id. This ID is used for
scoping the CSS rules to avoid conflicts with the existing page styles.
See <code>src/template.html</code> and <code>src/style.sass</code> for the source files.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">template = </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[[ DOCCO DOESN&#39;T HANDLE THIS WELL, SEE src/template.html ]]</span>
<span class="s2">&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-18'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-18">#</a>
        </div>
        <p>Initialize variables so they're visible to all internal functions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">$           = </span><span class="kc">null</span>
<span class="nv">settings    = </span><span class="kc">null</span>
<span class="nv">$els        = </span><span class="kc">null</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-19'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-19">#</a>
        </div>
        <p>State variables</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">active              = </span><span class="kc">false</span>
<span class="nv">deferred            = </span><span class="kc">false</span>
<span class="nv">loaded              = </span><span class="kc">false</span>
<span class="nv">showing_multi_line  = </span><span class="kc">false</span>
<span class="nv">history_index       = </span><span class="mi">0</span>
<span class="nv">loaded_scripts =</span>
    <span class="nv">jquery_js       : </span><span class="kc">false</span>
    <span class="nv">coffeescript_js : </span><span class="kc">false</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-20'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-20">#</a>
        </div>
        <p>Track the input history with a list of objects like this...
<code>{
source: 'CoffeeScript code',
result: 'result of eval'
}</code>
...in order of entry by the user.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">history = </span><span class="p">[]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-21'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-21">#</a>
        </div>
        <h2>Main functions</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-22'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-22">#</a>
        </div>
        <h3>init</h3>
<p>Loads settings, and initiates the rendering of the widget and loading of
previous history from localStorage.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">init = </span><span class="nf">(opts={}) -&gt;</span>
    <span class="k">if</span> <span class="nx">loaded_scripts</span><span class="p">.</span><span class="nx">jquery_js</span> <span class="o">and</span> <span class="nx">loaded_scripts</span><span class="p">.</span><span class="nx">coffeescript_js</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-23'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-23">#</a>
        </div>
        <p>Use $ even if jQuery is in no-conflict mode</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">$ = </span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-24'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-24">#</a>
        </div>
        <p>If window.console isn't present, and the widget is set to adopt log
and dir methods, create a console object with those methods and pass
them through to the internal log and dir methods.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">adopt_log</span> <span class="o">or</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">adopt_dir</span><span class="p">)</span> <span class="o">and</span> <span class="o">not</span> <span class="nb">window</span><span class="p">.</span><span class="nx">console</span><span class="o">?</span>
            <span class="nb">window</span><span class="p">.</span><span class="nv">console = </span><span class="p">{}</span>
            <span class="k">if</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">adopt_log</span>
                <span class="nb">window</span><span class="p">.</span><span class="nv">console.log = </span><span class="nf">(args...) -&gt;</span>
                    <span class="nx">ctLog</span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span>
            <span class="k">if</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">adopt_dir</span>
                <span class="nb">window</span><span class="p">.</span><span class="nv">console.dir = </span><span class="nf">(args...) -&gt;</span>
                    <span class="nx">ctDir</span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-25'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-25">#</a>
        </div>
        <p>Alias log and dir for shorter typing</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nb">window</span><span class="p">.</span><span class="nv">log = </span><span class="nx">ctLog</span>
        <span class="nb">window</span><span class="p">.</span><span class="nv">dir = </span><span class="nx">ctDir</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-26'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-26">#</a>
        </div>
        <p>Apply the ID from settings to the template HTML and CSS.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">template = </span><span class="nx">template</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/__ID__/g</span><span class="p">,</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">widget_id</span><span class="p">)</span>
        <span class="nx">renderWidget</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-27'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-27">#</a>
        </div>
        <p>Load previous history if localStorage is enabled by settings.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">local_storage</span>
            <span class="nx">loadFromStorage</span><span class="p">()</span>

        <span class="nv">loaded = </span><span class="kc">true</span>
    <span class="k">return</span> <span class="nx">loaded</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-28'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-28">#</a>
        </div>
        <h3>ctLog</h3>
<p>Log one or more values to the CoffeeTable widget. Used as the implementation of
<code>console.log</code> if <code>settings.adopt_log</code> is <code>true</code> and <code>console.log</code> is not already
available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">ctLog = </span><span class="nf">(args...) -&gt;</span>
    <span class="k">for</span> <span class="nx">arg</span> <span class="k">in</span> <span class="nx">args</span>
        <span class="nx">do</span> <span class="o">-&gt;</span>
            <span class="nv">output = </span><span class="nx">arg</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\&#39;/g</span><span class="p">,</span><span class="s2">&quot;\\&#39;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\&quot;/g</span><span class="p">,</span><span class="s1">&#39;\\&quot;&#39;</span><span class="p">)</span>
            <span class="nx">execute</span><span class="p">(</span><span class="s2">&quot;&#39;log: #{ output }&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-29'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-29">#</a>
        </div>
        <h3>ctDir</h3>
<p>Dir one or more values to the CoffeeTable widget. Used as the implementation of
<code>console.dir</code> if <code>settings.adopt_dir</code> is <code>true</code> and <code>console.dir</code> is not already
available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">ctDir = </span><span class="nf">(args...) -&gt;</span>
    <span class="k">for</span> <span class="nx">arg</span> <span class="k">in</span> <span class="nx">args</span>
        <span class="nx">execute</span><span class="p">(</span><span class="nx">arg</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="k">return</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-30'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-30">#</a>
        </div>
        <h3>ctExec</h3>
<p>Takes in one or more strings of CoffeeScript code, which is then executed, in
order, by the widget. Returns the result of each execution in a list.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">ctExec = </span><span class="nf">(args...) -&gt;</span>
    <span class="nv">results = </span><span class="p">(</span><span class="nx">execute</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="k">for</span> <span class="nx">arg</span> <span class="k">in</span> <span class="nx">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">results</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-31'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-31">#</a>
        </div>
        <h3>buildAutosuggest</h3>
<p>Generate the auto-suggest list based on the object represented by the
supplied text. Done by iterating over the objects loaded, starting with
<code>window</code> and progressing through the subsequent properties.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">buildAutosuggest = </span><span class="nf">(text, e) -&gt;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-32'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-32">#</a>
        </div>
        <p>If the key is backspace and nothing is shown, or if the key is escape,
clear auto-suggest list.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">is</span> <span class="nx">keycode</span><span class="p">.</span><span class="nx">ESCAPE</span> <span class="o">or</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">is</span> <span class="nx">keycode</span><span class="p">.</span><span class="nx">BACKSPACE</span> <span class="o">and</span> <span class="nx">text</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">$els</span><span class="p">.</span><span class="nx">autosuggest_list</span><span class="p">.</span><span class="nx">html</span><span class="p">().</span><span class="nx">length</span> <span class="o">isnt</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nx">$els</span><span class="p">.</span><span class="nx">autosuggest_list</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-33'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-33">#</a>
        </div>
        <p>Rudimentary parsing by splitting on the <code>.</code> delimiter and using the
tokens as keys against each subsequent object.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">tokens = </span><span class="nx">text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-34'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-34">#</a>
        </div>
        <p>Start with the 'window' object...</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">working_items = </span><span class="p">[[</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;window&#39;</span><span class="p">]]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-35'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-35">#</a>
        </div>
        <p>...and iterate over the tokens, throwing out <code>(</code> and <code>)</code> from
function calls, and pushing the objects and keys onto the
working_items list.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="nx">token</span> <span class="k">in</span> <span class="nx">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="nv">token = </span><span class="nx">token</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">token</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="nx">working_items</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">working_items</span><span class="p">[</span><span class="nx">working_items</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="nx">token</span><span class="p">],</span> <span class="nx">token</span><span class="p">])</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-36'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-36">#</a>
        </div>
        <p>Set up the matching pattern to match the last token entered. This
process is wrapped in a try/catch to prevent faulty regex matches
from polluting the console with (inconsequential) errors.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">match_list = </span><span class="p">[]</span>
        <span class="k">try</span>
            <span class="nv">to_match = </span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="nx">tokens</span><span class="p">[</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-37'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-37">#</a>
        </div>
        <p>Iterate over the properties of the latest working_item, running the
matching pattern against the name of each one, building a list of
the properties that match.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">for</span> <span class="nx">attribute</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">working_items</span><span class="p">[</span><span class="nx">working_items</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="nv">matches = </span><span class="nx">to_match</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">attribute</span><span class="p">)</span>
                <span class="k">if</span> <span class="nx">matches</span><span class="o">?</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-38'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-38">#</a>
        </div>
        <p>Push the name and type of property (for color coding)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                    <span class="nx">match_list</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">attribute</span><span class="p">,</span> <span class="k">typeof</span> <span class="nx">value</span><span class="p">])</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-39'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-39">#</a>
        </div>
        <p>Sort the auto-suggest matches in ascending alphabetical order</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="nx">match_list</span><span class="p">.</span><span class="nx">sort</span><span class="p">()</span>
    </pre></div></pre></div>
      </td>
    </tr><tr id='section-40'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-40">#</a>
        </div>
        <p>Display the list of matches</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="nx">renderAutosuggest</span><span class="p">(</span><span class="nx">working_items</span><span class="p">,</span> <span class="nx">match_list</span><span class="p">)</span>
        <span class="k">catch</span> <span class="nx">e</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-41'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-41">#</a>
        </div>
        <h3>renderAutosuggest</h3>
<p>Build and show the ul for the auto-suggest matched items.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">renderAutosuggest = </span><span class="nf">(working_items, match_list) -&gt;</span>
    <span class="nv">list = </span><span class="s1">&#39;&#39;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-42'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-42">#</a>
        </div>
        <p>Add the full 'path' of the object currently being matched against.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">list</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="k">for</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">working_items</span>
    <span class="nv">html = </span><span class="s2">&quot;&lt;li class=&#39;current-object&#39;&gt;#{ list }&lt;/li&gt;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-43'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-43">#</a>
        </div>
        <p>Add each item matched, with a class based on the type for color coding.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;li class=&#39;#{ item[1] }&#39;&gt;#{ item[0] }&lt;/li&gt;&quot;</span> <span class="k">for</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">match_list</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-44'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-44">#</a>
        </div>
        <p>Show the complete list.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">$els</span><span class="p">.</span><span class="nx">autosuggest_list</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-45'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-45">#</a>
        </div>
        <p>Resize for good measure</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">resizeWidget</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-46'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-46">#</a>
        </div>
        <h3>loadFromStorage</h3>
<p>If localStorage is supported, try loading previous command history.
Throws an error if called when localStorage is not supported.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">loadFromStorage = </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">localStorage</span><span class="o">?</span>
        <span class="k">throw</span> <span class="s1">&#39;localStorage not supported by this browser. History will not be persisted.&#39;</span>
    <span class="k">else</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-47'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-47">#</a>
        </div>
        <p>Get previous data</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">previous_data = </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">ls_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">previous_data</span><span class="o">?</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-48'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-48">#</a>
        </div>
        <p>If data has been persisted, parse the string from localStorage
and execute each history item in order.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="nv">previous_data = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">previous_data</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-49'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-49">#</a>
        </div>
        <p>Replay the previous entries, running as a dry-run if specified in
settings.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="nx">execute</span><span class="p">(</span><span class="nx">entry_source</span><span class="p">,</span> <span class="o">not</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">replay_on_load</span><span class="p">)</span> <span class="k">for</span> <span class="nx">entry_source</span> <span class="k">in</span> <span class="nx">previous_data</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-50'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-50">#</a>
        </div>
        <h3>replayHistory</h3>
<p>Clear the display of the history and excute each item in the history.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">replayHistory = </span><span class="o">-&gt;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-51'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-51">#</a>
        </div>
        <p>Build the list of commands to replay.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">entries_to_replay = </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">source</span> <span class="k">for</span> <span class="nx">entry</span> <span class="k">in</span> <span class="nx">history</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-52'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-52">#</a>
        </div>
        <p>Clear the current history.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">history = </span><span class="p">[]</span>
    <span class="nx">$els</span><span class="p">.</span><span class="nx">history_list</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    <span class="nv">history_index = </span><span class="mi">0</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-53'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-53">#</a>
        </div>
        <p>Execute the previous entries. </p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">for</span> <span class="nx">entry_source</span> <span class="k">in</span> <span class="nx">entries_to_replay</span>
        <span class="nx">execute</span><span class="p">(</span><span class="nx">entry_source</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-54'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-54">#</a>
        </div>
        <h3>expandObject</h3>
<p>Given an element and result item, enumerate the properties of the result into
lists that can be expanded, recursively if the property is itself and object.
Used if the result is an object, and by the <code>dir</code> command.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">expandObject = </span><span class="nf">(li, result) -&gt;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-55'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-55">#</a>
        </div>
        <p>Each property that is an object gets an expand button, which
toggles between '+' if closed and '-' if open.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">expand_button_template = </span><span class="s1">&#39;&lt;button class=&quot;expand&quot;&gt;&lt;span class=&quot;closed&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;opened&quot;&gt;-&lt;/span&gt;&lt;/button&gt;&#39;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-56'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-56">#</a>
        </div>
        <p>Create an LI element for the given property and value.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">buildLI = </span><span class="nf">(prop, val) -&gt;</span>
        <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;li class=&#39;property-value&#39; title=&#39;#{ typeof val }: #{ val }&#39;&gt;</span>
<span class="s2">                &lt;span class=&#39;property&#39;&gt;#{ prop }:&lt;/span&gt;</span>
<span class="s2">                &lt;span class=&#39;value #{ typeof val }&#39;&gt;#{ val }&lt;/span&gt;</span>
<span class="s2">            &lt;/li&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
    </pre></div></pre></div>
      </td>
    </tr><tr id='section-57'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-57">#</a>
        </div>
        <p>List the properties of the given object, and append a UL with the
properties to the given element.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">assembleList = </span><span class="nf">(obj, el) -&gt;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-58'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-58">#</a>
        </div>
        <p>Remove any existing ULs to avoid duplication. Yes, this is
redundant, but it keeps things simple.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">()</span>
        </pre></div></pre></div>
      </td>
    </tr><tr id='section-59'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-59">#</a>
        </div>
        <p>Make and append the UL</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">children_ul = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;ul&gt;&lt;/ul&gt;&#39;</span><span class="p">)</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">children_ul</span><span class="p">)</span>
        </pre></div></pre></div>
      </td>
    </tr><tr id='section-60'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-60">#</a>
        </div>
        <p>Create a list of properties, then sort it so they can be
displayed in alphabetical order.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">prop_list = </span><span class="p">(</span><span class="nx">prop</span> <span class="k">for</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">obj</span><span class="p">)</span>
        <span class="nx">prop_list</span><span class="p">.</span><span class="nx">sort</span><span class="p">()</span>
        </pre></div></pre></div>
      </td>
    </tr><tr id='section-61'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-61">#</a>
        </div>
        <p>Iterate over the sorted properties, building an LI and
appending it to the list.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">prop_list</span> <span class="k">then</span> <span class="nx">do</span> <span class="o">-&gt;</span>
            <span class="nv">p_name = </span><span class="nx">prop</span>
            <span class="nv">p_val = </span><span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span>
            <span class="nv">child_li = </span><span class="nx">buildLI</span><span class="p">(</span><span class="nx">p_name</span><span class="p">,</span> <span class="nx">p_val</span><span class="p">)</span>
            <span class="nx">children_ul</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">child_li</span><span class="p">)</span>
            </pre></div></pre></div>
      </td>
    </tr><tr id='section-62'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-62">#</a>
        </div>
        <p>If the property itself is an object, prepare it to be
expandable as well.
TODO: rework this whole system so it's more DRY.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">if</span> <span class="k">typeof</span> <span class="nx">p_val</span> <span class="o">is</span> <span class="s1">&#39;object&#39;</span>
                <span class="nv">child_expand_button = </span><span class="nx">$</span><span class="p">(</span><span class="nx">expand_button_template</span><span class="p">)</span>
                <span class="nx">child_li</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;span.value&#39;</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">child_expand_button</span><span class="p">)</span>
                <span class="nx">child_expand_button</span><span class="p">.</span><span class="nx">click</span> <span class="nf">(e) -&gt;</span>
                    <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nx">child_li</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
                        <span class="nx">child_li</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
                        <span class="nx">child_li</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">()</span>
                    <span class="k">else</span>
                        <span class="nx">child_li</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
                        <span class="nx">children_ul</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
                        <span class="nx">assembleList</span><span class="p">(</span><span class="nx">p_val</span><span class="p">,</span> <span class="nx">child_li</span><span class="p">)</span>
    </pre></div></pre></div>
      </td>
    </tr><tr id='section-63'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-63">#</a>
        </div>
        <p>Create the expand button, append it to the LI, and setup the
events that toggle the opening and closing of property lists.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">expand_button = </span><span class="nx">$</span><span class="p">(</span><span class="nx">expand_button_template</span><span class="p">)</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;span.result&#39;</span><span class="p">).</span><span class="nx">before</span><span class="p">(</span><span class="nx">expand_button</span><span class="p">)</span>
    <span class="nx">expand_button</span><span class="p">.</span><span class="nx">click</span> <span class="o">-&gt;</span>
        <span class="k">if</span> <span class="nx">li</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
            <span class="nx">li</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
            <span class="nx">li</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">()</span>
        <span class="k">else</span>
            <span class="nx">li</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
            <span class="nx">assembleList</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">li</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-64'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-64">#</a>
        </div>
        <h3>execute</h3>
<p>Compile and evaluate the specified CoffeeScript source string. Optionally,
the execution can be a dry run and the source will not actually be executed.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">execute = </span><span class="nf">(source, dry_run=false, do_dir=false) -&gt;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-65'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-65">#</a>
        </div>
        <p>If the command is to clear localStorage, just clear the history instead.
Otherwise, the localStorage will be cleared, but the history remains in
memory and would be replaced into localStorage, negating the command.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">if</span> <span class="nx">source</span> <span class="o">is</span> <span class="s1">&#39;localStorage.clear()&#39;</span>
        <span class="nx">clearHistory</span><span class="p">()</span>
    <span class="k">else</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-66'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-66">#</a>
        </div>
        <p>Clear the displayed history list if history is empty.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
            <span class="nx">$els</span><span class="p">.</span><span class="nx">history_list</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-67'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-67">#</a>
        </div>
        <p>Reset the index for the history's arrow-navigation.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">history_index = </span><span class="o">-</span><span class="mi">1</span>

        <span class="nv">error_output = </span><span class="kc">null</span>
        <span class="nv">cs_error = </span><span class="kc">false</span>
        <span class="nv">js_error = </span><span class="kc">false</span>
        <span class="nv">result = </span><span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="nx">do_dir</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-68'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-68">#</a>
        </div>
        <p>If executing a <code>dir</code>, the result is the passed-in source, and the
source to be saved is a string describing the <code>dir</code>. This means
<code>dirs</code> using the widget cannot be replayed.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="nv">result = </span><span class="nx">source</span>
            <span class="nv">source = </span><span class="s2">&quot;&#39;dir: #{ source.toString().replace(&quot;</span><span class="s1">&#39;&quot;,&quot;\\&#39;</span><span class="s2">&quot;) }&#39;&quot;</span>

        <span class="k">else</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-69'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-69">#</a>
        </div>
        <p>Attempt to compile the CoffeeScript source, using <code>bare: on</code> so that
it's not wrapped in a closure and the output can be captured.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">try</span>
                <span class="nv">compiled_js = </span><span class="nx">CoffeeScript</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="p">{</span> <span class="nv">bare: </span><span class="kc">on</span> <span class="p">})</span>
            <span class="k">catch</span> <span class="nx">error</span>
                <span class="nv">cs_error = </span><span class="kc">true</span>
                <span class="nv">error_output = </span><span class="nx">error</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-70'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-70">#</a>
        </div>
        <p>If the source compiled cleanly, and not doing a dry run, try
evaluating the JavaScript in the global context.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="nx">error_output</span><span class="o">?</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">dry_run</span>
                <span class="k">try</span>
                    <span class="nv">result = </span><span class="nb">eval</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">compiled_js</span><span class="p">)</span>
                <span class="k">catch</span> <span class="nx">eval_error</span>
                    <span class="nv">js_error = </span><span class="kc">true</span>
                    <span class="nv">error_output = </span><span class="nx">eval_error</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-71'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-71">#</a>
        </div>
        <p>If doing a dry run, the result is just the compiled CoffeeScript.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">else</span> <span class="k">if</span> <span class="nx">dry_run</span>
                <span class="nv">result = </span><span class="nx">compiled_js</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-72'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-72">#</a>
        </div>
        <p>If there is an error, that becomes the result.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nx">error_output</span><span class="o">?</span>
            <span class="nv">result = </span><span class="nx">error_output</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-73'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-73">#</a>
        </div>
        <p>Add the source and corresponding result to the history.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nx">history</span><span class="p">.</span><span class="nx">push</span>
            <span class="nv">result: </span><span class="nx">result</span>
            <span class="nv">source: </span><span class="k">if</span> <span class="nx">do_dir</span> <span class="k">then</span> <span class="nx">source</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="k">else</span> <span class="nx">source</span>
        </pre></div></pre></div>
      </td>
    </tr><tr id='section-74'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-74">#</a>
        </div>
        <p>Prepare the list item for this history entry. The result is inserted
using jQuery's .text to ensure proper escaping.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">this_result_index = </span><span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span>
        
        <span class="nv">load_button = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;button class=&#39;load&#39; title=&#39;load: #{ source }&#39;&gt;^&lt;/button&gt;&quot;</span><span class="p">)</span>

        <span class="nv">clean_result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;/g</span><span class="p">,</span> <span class="s2">&quot;&amp;amp;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;/g</span><span class="p">,</span> <span class="s2">&quot;&amp;lt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&amp;gt;&quot;</span><span class="p">)</span>
        <span class="nv">new_li = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;li class=&#39;#{ typeof result }&#39; title=&#39;#{ typeof result }: #{ clean_result }&#39;&gt;</span>

<span class="s2">#DIVIDER</span>
<span class="s2">                &lt;span class=&#39;result&#39;&gt;#{ clean_result }&lt;/span&gt;</span>
<span class="s2">            &lt;/li&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">load_button</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-75'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-75">#</a>
        </div>
        <p>{ this_result_index }:</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nx">js_error</span>
            <span class="nx">new_li</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;js-error&#39;</span><span class="p">)</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">cs_error</span>
            <span class="nx">new_li</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;cs-error&#39;</span><span class="p">)</span>
        <span class="k">else</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-76'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-76">#</a>
        </div>
        <p>Set the appropriate classes if there were an error.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">if</span> <span class="k">typeof</span> <span class="nx">result</span> <span class="o">is</span> <span class="s1">&#39;object&#39;</span> <span class="o">or</span> <span class="nx">do_dir</span>
                <span class="nx">expandObject</span><span class="p">(</span><span class="nx">new_li</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-77'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-77">#</a>
        </div>
        <p>Results that are objects can be expanded, with their properties
enumerated in a list. (And only try to expand if not an error.)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nx">load_button</span><span class="p">.</span><span class="nx">click</span> <span class="o">-&gt;</span>
            <span class="nx">loadPrevious</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">this_result_index</span><span class="p">)</span>
            <span class="nx">$els</span><span class="p">.</span><span class="nx">textarea</span><span class="p">.</span><span class="nx">focus</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-78'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-78">#</a>
        </div>
        <p>When the history entry's load button is clicked, load the source for
that entry.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nx">new_li</span><span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$els</span><span class="p">.</span><span class="nx">history_list</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-79'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-79">#</a>
        </div>
        <p>Add the history entry to the history list</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">entry_sources = </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">source</span> <span class="k">for</span> <span class="nx">entry</span> <span class="k">in</span> <span class="nx">history</span><span class="p">)</span>
        <span class="nx">localStorage</span><span class="o">?</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">ls_key</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">entry_sources</span><span class="p">))</span>

        <span class="nx">$els</span><span class="p">.</span><span class="nx">clear_history</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
        <span class="nx">$els</span><span class="p">.</span><span class="nx">replay_history</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="nx">result</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-80'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-80">#</a>
        </div>
        <p>If localStorage is supported, save the current history to the key
specified by settings.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">clearHistory = </span><span class="o">-&gt;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-81'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-81">#</a>
        </div>
        <h3>clearHistory</h3>
<p>Empty the history in memory, disk, and page.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">$els</span><span class="p">.</span><span class="nx">history_list</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    </pre></div></pre></div>
      </td>
    </tr><tr id='section-82'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-82">#</a>
        </div>
        <p>Clear the displayed history.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">history = </span><span class="p">[]</span>
    </pre></div></pre></div>
      </td>
    </tr><tr id='section-83'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-83">#</a>
        </div>
        <p>Clear the in-memory history.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">localStorage</span><span class="o">?</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">ls_key</span><span class="p">)</span>

    <span class="nx">renderInstructions</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-84'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-84">#</a>
        </div>
        <p>Clear the history persisted in localStorage, if any.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">autosuggest = </span><span class="p">[[</span><span class="nb">window</span><span class="p">,</span><span class="s1">&#39;window&#39;</span><span class="p">]]</span>
    <span class="nv">autsuggest_query = </span><span class="s1">&#39;&#39;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-85'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-85">#</a>
        </div>
        <p>Reset the auto-suggest.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">$els</span><span class="p">.</span><span class="nx">clear_history</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
    <span class="nx">$els</span><span class="p">.</span><span class="nx">replay_history</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-86'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-86">#</a>
        </div>
        <p>Hide the history controls.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">renderInstructions = </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nx">showing_multi_line</span>
            <span class="nv">instructions = </span><span class="s1">&#39;type CoffeeScript, press &lt;shift+enter&gt;&#39;</span>
        <span class="k">else</span>
            <span class="nv">instructions = </span><span class="s1">&#39;type CoffeeScript, press &lt;enter&gt;&#39;</span> 
        <span class="nx">$els</span><span class="p">.</span><span class="nx">instructions</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">instructions</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-87'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-87">#</a>
        </div>
        <h3>renderInstructions</h3>
<p>Show instructions for how to use the widget, depending on multi-line setting.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">loadPrevious = </span><span class="nf">(forward=false, target_index) -&gt;</span>
    <span class="k">if</span> <span class="nx">target_index</span><span class="o">?</span>
        <span class="nv">history_index = </span><span class="nx">target_index</span> <span class="o">+</span> <span class="mi">1</span> </pre></div></pre></div>
      </td>
    </tr><tr id='section-88'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-88">#</a>
        </div>
        <h3>loadPrevious</h3>
<p>Given a history index to load, set the current source input to the source of
that entry. Supports going either direction through the history; pass <code>true</code>
for <code>forward</code> to move forward in the list.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">if</span> <span class="nx">history_index</span> <span class="o">is</span> <span class="o">-</span><span class="mi">1</span> <span class="o">or</span> <span class="nx">history_index</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nv">history_index = </span><span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span>
        <span class="k">if</span> <span class="nx">forward</span>
            <span class="nx">history_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span>
            <span class="nx">history_index</span> <span class="o">-=</span> <span class="mi">1</span>
    </pre></div></pre></div>
      </td>
    </tr><tr id='section-89'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-89">#</a>
        </div>
        <p>Currently not "inside" the history, so start at the most recent entry.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">if</span> <span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nx">$els</span><span class="p">.</span><span class="nx">textarea</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">history</span><span class="p">[</span><span class="nx">history_index</span><span class="p">].</span><span class="nx">source</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-90'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-90">#</a>
        </div>
        <p>If the selected index is "inside" the history list (eg -1), load the
entry at that index.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nv">$els.textarea.selectionStart = </span><span class="mi">0</span>
        <span class="nv">$els.textarea.selectionEnd = </span><span class="mi">0</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-91'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-91">#</a>
        </div>
        <p>Keep the cursor at the start of the textarea, so the user can
continue to step through using the arrows.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">toggleMultiLine = </span><span class="o">-&gt;</span>
    <span class="nv">showing_multi_line = </span><span class="o">not</span> <span class="nx">showing_multi_line</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-92'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-92">#</a>
        </div>
        <h3>toggleMultiline</h3>
<p>Switch between single-line and multi-line modes, disabling auto-suggest if in
multi-line mode.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">if</span> <span class="nx">showing_multi_line</span>
        <span class="nv">new_height = </span><span class="s1">&#39;4em&#39;</span>
        <span class="nx">$els</span><span class="p">.</span><span class="nx">autosuggest_list</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-93'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-93">#</a>
        </div>
        <p>Set height to larger and hide auto-suggest...</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">else</span>
        <span class="nv">new_height = </span><span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">auto_suggest</span>
            <span class="nx">$els</span><span class="p">.</span><span class="nx">autosuggest_list</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>

    <span class="nx">$els</span><span class="p">.</span><span class="nx">textarea</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span><span class="nx">new_height</span><span class="p">).</span><span class="nx">focus</span><span class="p">()</span>
    <span class="nx">renderInstructions</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-94'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-94">#</a>
        </div>
        <p>...or reset height and show auto-suggest, if enabled.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">resizeWidget = </span><span class="o">-&gt;</span>
    <span class="nv">height = </span><span class="s2">&quot;#{ window.innerHeight - 140 }px&quot;</span>
    <span class="nv">width = </span><span class="s2">&quot;#{ window.innerWidth - 255 }px&quot;</span>
    <span class="nx">$els</span><span class="p">.</span><span class="nx">autosuggest_list</span><span class="p">.</span><span class="nx">css</span>
        <span class="s1">&#39;max-height&#39;</span>    <span class="o">:</span> <span class="nx">height</span>
        <span class="s1">&#39;max-width&#39;</span>     <span class="o">:</span> <span class="nx">width</span>
    <span class="nx">$els</span><span class="p">.</span><span class="nx">history_list</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;max-height&#39;</span><span class="p">,</span><span class="nx">height</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-95'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-95">#</a>
        </div>
        <h3>resizeWidget</h3>
<p>Set the max-height and max-width of the widget and auto-suggest list to keep
it visible in the window. (Being absolutely positioned, it does not affect the
scrolling of the overall window.)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">renderWidget = </span><span class="o">-&gt;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-96'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-96">#</a>
        </div>
        <h3>renderWidget</h3>
<p>Build and display the widget elements.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">widget = </span><span class="nx">$</span><span class="p">(</span><span class="nx">template</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-97'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-97">#</a>
        </div>
        <p>Load the template into a jQuery object.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">$els =</span>
        <span class="nv">widget              : </span><span class="nx">widget</span>
        <span class="nv">textarea            : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;textarea&#39;</span><span class="p">)</span>
        <span class="nv">autosuggest_list    : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;ul.autosuggest&#39;</span><span class="p">)</span>
        <span class="nv">history_list        : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;ul.history&#39;</span><span class="p">)</span>
        <span class="nv">button              : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">)</span>
        <span class="nv">div                 : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span>
        <span class="nv">clear_history       : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;span.clear&#39;</span><span class="p">)</span>
        <span class="nv">replay_history      : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;span.replay&#39;</span><span class="p">)</span>
        <span class="nv">a                   : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="nv">toggle_multiline    : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
        <span class="nv">p                   : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;p.mode&#39;</span><span class="p">)</span>
        <span class="nv">instructions        : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;p.instructions&#39;</span><span class="p">)</span>
        <span class="nv">li                  : </span><span class="nx">widget</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-98'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-98">#</a>
        </div>
        <p>Capture all the elements for later reference.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">$els</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">css</span>
        <span class="s1">&#39;position&#39;</span>          <span class="o">:</span> <span class="s2">&quot;#{ settings.widget_position }&quot;</span>
        <span class="s1">&#39;top&#39;</span>               <span class="o">:</span> <span class="s2">&quot;#{ settings.widget_top }&quot;</span>
        <span class="s1">&#39;right&#39;</span>             <span class="o">:</span> <span class="s2">&quot;#{ settings.widget_right }&quot;</span>

    <span class="nx">renderInstructions</span><span class="p">()</span>
    <span class="nx">bindEvents</span><span class="p">()</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
    </pre></div></pre></div>
      </td>
    </tr><tr id='section-99'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-99">#</a>
        </div>
        <p>Apply these styles programmatically so they can be customized in settings.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">resizeWidget</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-100'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-100">#</a>
        </div>
        <p>Do resize of the widget to ensure the contained elements can scroll
correctly.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">bindEvents = </span><span class="o">-&gt;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-101'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-101">#</a>
        </div>
        <h3>bindEvents</h3>
<p>Setup the various events for the control elements.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">$els</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">click</span> <span class="o">-&gt;</span>
        <span class="nv">active = </span><span class="o">not</span> <span class="nx">active</span>
        <span class="k">if</span> <span class="nx">active</span>
            <span class="nx">$els</span><span class="p">.</span><span class="nx">div</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
            <span class="nx">$els</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
            <span class="nx">$els</span><span class="p">.</span><span class="nx">textarea</span><span class="p">.</span><span class="nx">focus</span><span class="p">()</span>
            <span class="nx">$els</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>
        <span class="k">else</span>
            <span class="nx">$els</span><span class="p">.</span><span class="nx">div</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
            <span class="nx">$els</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
            <span class="nx">$els</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-102'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-102">#</a>
        </div>
        <p>Toggle the main edit elements of the widget.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">$els</span><span class="p">.</span><span class="nx">clear_history</span><span class="p">.</span><span class="nx">click</span> <span class="o">-&gt;</span>
        <span class="nx">clearHistory</span><span class="p">()</span>
    </pre></div></pre></div>
      </td>
    </tr><tr id='section-103'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-103">#</a>
        </div>
        <p>Clear history on demand.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">$els</span><span class="p">.</span><span class="nx">replay_history</span><span class="p">.</span><span class="nx">click</span> <span class="o">-&gt;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-104'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-104">#</a>
        </div>
        <p>Replay history on demand.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nx">$els</span><span class="p">.</span><span class="nx">history_list</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
        <span class="nx">setTimeout</span> <span class="o">-&gt;</span>
            <span class="nx">replayHistory</span><span class="p">()</span>
        <span class="p">,</span> <span class="mi">100</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-105'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-105">#</a>
        </div>
        <p>Empty the list now and replay after a slight delay, so there is a
visual indication that something happened.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">$els</span><span class="p">.</span><span class="nx">toggle_multiline</span><span class="p">.</span><span class="nx">click</span> <span class="o">-&gt;</span>
        <span class="nx">toggleMultiLine</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-106'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-106">#</a>
        </div>
        <p>Toggle multi-line mode on demand.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">$els</span><span class="p">.</span><span class="nx">textarea</span><span class="p">.</span><span class="nx">bind</span> <span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="nf">(e) -&gt;</span>
        <span class="nv">entered_source = </span><span class="nx">$els</span><span class="p">.</span><span class="nx">textarea</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-107'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-107">#</a>
        </div>
        <p>Bind main textarea events to keydown for quicker responsiveness.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nx">@selectionStart</span> <span class="o">is</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">is</span> <span class="nx">keycode</span><span class="p">.</span><span class="nx">UP</span>
                <span class="nx">loadPrevious</span><span class="p">()</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">is</span> <span class="nx">keycode</span><span class="p">.</span><span class="nx">DOWN</span>
                <span class="nx">loadPrevious</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-108'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-108">#</a>
        </div>
        <p>If the cursor is at the start of the textarea and the up or down
arrows are pressed, step through the history.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">is</span> <span class="nx">keycode</span><span class="p">.</span><span class="nx">ENTER</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="nx">showing_multi_line</span> <span class="o">or</span> <span class="nx">e</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">)</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
            <span class="k">if</span> <span class="nx">entered_source</span> <span class="o">isnt</span> <span class="s1">&#39;&#39;</span>
                <span class="nx">execute</span><span class="p">(</span><span class="nx">entered_source</span><span class="p">)</span>
                <span class="nx">$els</span><span class="p">.</span><span class="nx">textarea</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-109'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-109">#</a>
        </div>
        <p>If enter was pressed and in single-line mode or the shift key was
pressed, and the source isn't blank, execute it and clear the input.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">else</span> <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">is</span> <span class="nx">keycode</span><span class="p">.</span><span class="nx">TAB</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-110'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-110">#</a>
        </div>
        <p>Treat tab the way a text-editor should.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-111'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-111">#</a>
        </div>
        <p>Prevent the textarea losing focus.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="nv">start = </span><span class="nx">@selectionStart</span>
            <span class="nv">end = </span><span class="nx">@selectionEnd</span>
            <span class="vi">@value = </span><span class="nx">@value</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">start</span><span class="p">)</span> <span class="o">+</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">indent</span> <span class="o">+</span> <span class="nx">@value</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">start</span><span class="p">)</span>
            <span class="vi">@selectionStart = </span><span class="nx">start</span> <span class="o">+</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">indent</span><span class="p">.</span><span class="nx">length</span>
            <span class="vi">@selectionEnd = </span><span class="nx">start</span> <span class="o">+</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">indent</span><span class="p">.</span><span class="nx">length</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-112'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-112">#</a>
        </div>
        <p>Insert the specified indent characters at cursor location.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">$els</span><span class="p">.</span><span class="nx">textarea</span><span class="p">.</span><span class="nx">bind</span> <span class="s1">&#39;keyup&#39;</span><span class="p">,</span> <span class="nf">(e) -&gt;</span>
        <span class="nv">entered_source = </span><span class="nx">$els</span><span class="p">.</span><span class="nx">textarea</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-113'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-113">#</a>
        </div>
        <p>Bind auto-suggest to keyup for better overall performance.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="o">not</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">multi_line</span> <span class="o">and</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">auto_suggest</span>
            <span class="nx">buildAutosuggest</span><span class="p">(</span><span class="nx">entered_source</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-114'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-114">#</a>
        </div>
        <p>Only run auto-suggest if enabled and widget is in single-line mode.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">if</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">multi_line</span>
        <span class="nx">$els</span><span class="p">.</span><span class="nx">toggle_multiline</span><span class="p">.</span><span class="nx">click</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-115'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-115">#</a>
        </div>
        <p>Set the initial multi-line state based on the settings.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span> <span class="o">-&gt;</span>
        <span class="nx">resizeWidget</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-116'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-116">#</a>
        </div>
        <p>Keep the auto-suggest and history lists within the window.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">unloadWidget = </span><span class="nf">() -&gt;</span>
    <span class="nx">$els</span><span class="o">?</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">CoffeeTable = </span><span class="kc">null</span>
    <span class="k">delete</span> <span class="nb">window</span><span class="p">.</span><span class="nx">CoffeeTable</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-117'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-117">#</a>
        </div>
        <h3>unloadWidget</h3>
<p>Remove the widget element from the DOM and clear the <code>CoffeeTable</code> object.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-118'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-118">#</a>
        </div>
        <h2>Export the API</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">CoffeeTable =</span>
    <span class="nv">show: </span><span class="o">-&gt;</span>
        <span class="nx">$els</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">this</span>
    <span class="nv">hide: </span><span class="o">-&gt;</span>
        <span class="nx">$els</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">this</span>
    <span class="nv">clear: </span><span class="o">-&gt;</span>
        <span class="nx">clearHistory</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">this</span>
    <span class="nv">replay: </span><span class="o">-&gt;</span>
        <span class="nx">replayHistory</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">this</span>
    <span class="nv">deferInit: </span><span class="o">-&gt;</span>
        <span class="nv">deferred = </span><span class="kc">true</span>
        <span class="k">return</span> <span class="k">this</span>
    <span class="nv">init: </span><span class="nf">(opts) -&gt;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">CoffeeTable</span><span class="o">?</span><span class="p">.</span><span class="nx">unload</span><span class="p">()</span> <span class="c1"># Unload any previous widget</span>
        <span class="nx">setSettings</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span>
        <span class="nx">preInit</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">this</span>
    <span class="nv">unload: </span><span class="o">-&gt;</span>
        <span class="nx">unloadWidget</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">this</span>
    <span class="nv">active: </span><span class="o">-&gt;</span>
        <span class="k">return</span> <span class="nx">active</span>
    <span class="nv">log: </span><span class="nf">(args...) -&gt;</span>
        <span class="nx">ctLog</span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span>
        <span class="k">return</span>
    <span class="nv">dir: </span><span class="nf">(args...) -&gt;</span>
        <span class="nx">ctDir</span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span>
        <span class="k">return</span>
    <span class="nv">exec: </span><span class="nf">(args...) -&gt;</span>
        <span class="k">return</span> <span class="nx">ctExec</span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span>
    <span class="nv">version: </span><span class="nx">VERSION</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-119'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-119">#</a>
        </div>
        <p>Reassign the API functions</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-120'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-120">#</a>
        </div>
        <h2>Loading</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">setSettings = </span><span class="nf">(opts) -&gt;</span>
    <span class="nv">settings = </span><span class="nx">defaults</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">opts</span>
        <span class="nx">settings</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-121'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-121">#</a>
        </div>
        <h3>setSettings</h3>
<p>Load the default settings and apply user overrides.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">loadScript = </span><span class="nf">(script_name) -&gt;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-122'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-122">#</a>
        </div>
        <h3>loadScript</h3>
<p>Helper for loading external scripts.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">head = </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nv">script = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span>
    <span class="nv">script.type = </span><span class="s1">&#39;application/javascript&#39;</span>
    <span class="nv">script.src = </span><span class="nx">settings</span><span class="p">[</span><span class="nx">script_name</span><span class="p">]</span>
    <span class="nv">script.async = </span><span class="kc">true</span>
    <span class="nv">script.onload = </span><span class="o">-&gt;</span>
        <span class="nx">loaded_scripts</span><span class="p">[</span><span class="nx">script_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="nx">init</span><span class="p">()</span>
    <span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-123'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-123">#</a>
        </div>
        <p>Do all the traversing and manipulation directly, since jQuery may not
be available yet.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nv">preInit = </span><span class="o">-&gt;</span>
    <span class="nv">active = </span><span class="kc">false</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-124'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-124">#</a>
        </div>
        <h3>preInit</h3>
<p>Helper for prepping settings and checking if dependencies are loaded.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nv">loaded_scripts.jquery_js = </span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span><span class="o">?</span>
    <span class="nv">loaded_scripts.coffeescript_js = </span><span class="nb">window</span><span class="p">.</span><span class="nx">CoffeeScript</span><span class="o">?</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-125'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-125">#</a>
        </div>
        <p>Check if jQuery and CoffeeScript have already been loaded.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="nx">loaded_scripts</span><span class="p">.</span><span class="nx">coffeescript_js</span>
        <span class="k">if</span> <span class="o">not</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">autoload_coffee_script</span>
            <span class="k">throw</span> <span class="s1">&#39;CoffeeTable requires coffee_script.js&#39;</span>
        <span class="k">else</span>
            <span class="nx">loadScript</span><span class="p">(</span><span class="s1">&#39;coffeescript_js&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">loaded_scripts</span><span class="p">.</span><span class="nx">jquery_js</span>
        <span class="k">if</span> <span class="o">not</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">autoload_jquery</span>
            <span class="k">throw</span> <span class="s1">&#39;CoffeeTable requires jQuery&#39;</span>
        <span class="k">else</span>
            <span class="nx">loadScript</span><span class="p">(</span><span class="s1">&#39;jquery_js&#39;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-126'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-126">#</a>
        </div>
        <p>If the scripts haven't been loaded, load them, or throw an error if
loading is disabled in settings.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="nx">init</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-127'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-127">#</a>
        </div>
        <p>Try init here (in case the scripts are already loaded).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">deferred</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">loaded</span>
        <span class="nx">setSettings</span><span class="p">()</span>
        <span class="nx">preInit</span><span class="p">()</span>
<span class="p">,</span> <span class="kc">false</span><span class="p">)</span>

</pre></div></pre></div>
      </td>
    </tr><tr id='section-128'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-128">#</a>
        </div>
        <h3>DOM ready event</h3>
<p>Automatically load dependencies and initialize the widget, unless deferred.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
